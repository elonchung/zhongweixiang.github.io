<!-- build time:Tue May 05 2020 18:09:55 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><meta name="referrer" content="never"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>MySQL的子查询 | Elon Chung - JAVA PHP Web Developer Blog</title><meta name="description" content="子查询，又叫内部查询，相对于内部查询，包含内部查询的就称为外部查询"><meta name="keywords" content="php,mysql,sql子查询,子查询,标量子查询,列子查询,行子查询,表子查询 N 列。"><meta property="og:type" content="article"><meta property="og:title" content="MySQL的子查询"><meta property="og:url" content="https://www.elonchung.cn/2017/07/zichaxun/index.html"><meta property="og:site_name" content="Elon Chung - JAVA PHP Web Developer Blog"><meta property="og:description" content="子查询，又叫内部查询，相对于内部查询，包含内部查询的就称为外部查询"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2018-05-05T04:53:09.762Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MySQL的子查询"><meta name="twitter:description" content="子查询，又叫内部查询，相对于内部查询，包含内部查询的就称为外部查询"><link rel="canonical" href="https://www.elonchung.cn/2017/07/zichaxun/index.html"><link rel="alternate" href="/atom.xml" title="Elon Chung - JAVA PHP Web Developer Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/zhongweixiang?tab=repositories" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.png" width="200" height="200" alt="avatar"></a><h2 id="name" class="hidden-xs hidden-sm">Elon Chung</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">JAVA PHP Web Developer</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/zhongweixiang?tab=repositories" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/331845158" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LAMP/">LAMP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/优化/">优化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习资料/">学习资料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/小公举/">小公举</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/成长鸡汤/">成长鸡汤</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LAMP/">LAMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP框架/">PHP框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swoole/">Swoole</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phpstorm/">phpstorm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/seo/">seo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小公举/">小公举</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/资料/">资料</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/Git/" style="font-size:13.33px">Git</a> <a href="/tags/HTTP/" style="font-size:13.33px">HTTP</a> <a href="/tags/LAMP/" style="font-size:13px">LAMP</a> <a href="/tags/Markdown/" style="font-size:13px">Markdown</a> <a href="/tags/MySQL/" style="font-size:13px">MySQL</a> <a href="/tags/PHP/" style="font-size:14px">PHP</a> <a href="/tags/PHP框架/" style="font-size:13px">PHP框架</a> <a href="/tags/Python/" style="font-size:13px">Python</a> <a href="/tags/RabbitMQ/" style="font-size:13px">RabbitMQ</a> <a href="/tags/Swoole/" style="font-size:13px">Swoole</a> <a href="/tags/git/" style="font-size:13px">git</a> <a href="/tags/hexo/" style="font-size:13px">hexo</a> <a href="/tags/phpstorm/" style="font-size:13px">phpstorm</a> <a href="/tags/seo/" style="font-size:13px">seo</a> <a href="/tags/tools/" style="font-size:13px">tools</a> <a href="/tags/前端/" style="font-size:13px">前端</a> <a href="/tags/小公举/" style="font-size:13.67px">小公举</a> <a href="/tags/数据库/" style="font-size:13.33px">数据库</a> <a href="/tags/爬虫/" style="font-size:13px">爬虫</a> <a href="/tags/资料/" style="font-size:13px">资料</a> <a href="/tags/面试/" style="font-size:13px">面试</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/05/logbak/" class="title">logback.xml</a></p><p class="item-date"><time datetime="2020-05-05T09:27:02.466Z" itemprop="datePublished">20-05-05</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/04/queue/" class="title">消息对列案例 -- 事务的二段提交</a></p><p class="item-date"><time datetime="2020-04-23T08:23:58.531Z" itemprop="datePublished">20-04-23</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/04/maven-pom/" class="title">Maven -- pom.xml</a></p><p class="item-date"><time datetime="2020-04-23T01:51:34.684Z" itemprop="datePublished">20-04-23</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/面试/">面试</a></p><p class="item-title"><a href="/2018/11/mianshiti/" class="title">面试题库</a></p><p class="item-date"><time datetime="2018-11-15T05:21:52.000Z" itemprop="datePublished">18-11-15</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/PHP/">PHP</a></p><p class="item-title"><a href="/2018/06/improve/" class="title">PHP架构师之路-提高阶段</a></p><p class="item-date"><time datetime="2018-06-02T05:21:52.000Z" itemprop="datePublished">18-06-02</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、子查询定义"><span class="toc-number">1.</span> <span class="toc-text">一、子查询定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义："><span class="toc-number">1.1.</span> <span class="toc-text">定义：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、子查询分类"><span class="toc-number">2.</span> <span class="toc-text">二、子查询分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#子查询分为如下几类："><span class="toc-number">2.1.</span> <span class="toc-text">子查询分为如下几类：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#标量子查询："><span class="toc-number">2.1.1.</span> <span class="toc-text">标量子查询：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-列子查询："><span class="toc-number">2.1.2.</span> <span class="toc-text">MySQL 列子查询：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-行子查询："><span class="toc-number">2.1.3.</span> <span class="toc-text">MySQL 行子查询：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-表子查询："><span class="toc-number">2.1.4.</span> <span class="toc-text">MySQL 表子查询：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、字查询例举"><span class="toc-number">3.</span> <span class="toc-text">三、字查询例举</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ANY进行子查询"><span class="toc-number">3.0.1.</span> <span class="toc-text">ANY进行子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用IN进行子查询"><span class="toc-number">3.0.2.</span> <span class="toc-text">使用IN进行子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用SOME进行子查询"><span class="toc-number">3.0.3.</span> <span class="toc-text">使用SOME进行子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用ALL进行子查询"><span class="toc-number">3.0.4.</span> <span class="toc-text">使用ALL进行子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#标量子查询"><span class="toc-number">3.0.5.</span> <span class="toc-text">标量子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多值子查询"><span class="toc-number">3.0.6.</span> <span class="toc-text">多值子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#独立子查询"><span class="toc-number">3.0.7.</span> <span class="toc-text">独立子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#相关子查询"><span class="toc-number">3.0.8.</span> <span class="toc-text">相关子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXISTS谓词"><span class="toc-number">3.0.9.</span> <span class="toc-text">EXISTS谓词</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#派生表"><span class="toc-number">3.0.10.</span> <span class="toc-text">派生表</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#四、子查询优化"><span class="toc-number">4.</span> <span class="toc-text">四、子查询优化</span></a></li></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-zichaxun" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">MySQL的子查询</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2017/07/zichaxun/" class="article-date"><time datetime="2017-07-09T05:21:52.000Z" itemprop="datePublished">17-07-09</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/MySQL/">MySQL</a></span> <span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link" href="/tags/MySQL/">MySQL</a></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2017/07/zichaxun/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 3,210(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 12(分)</span></div></div><div class="article-entry markdown-body" itemprop="articleBody"><h2 id="一、子查询定义"><a href="#一、子查询定义" class="headerlink" title="一、子查询定义"></a>一、子查询定义</h2><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><ul><li>子查询允许把一个查询嵌套在另一个查询当中。</li><li>子查询，又叫内部查询，相对于内部查询，包含内部查询的就称为外部查询。</li><li>子查询可以包含普通select可以包括的任何子句，比如：distinct、 group by、order by、limit、join和union等；但是对应的外部查询必须是以下语句之一：select、insert、update、delete、set或 者do。</li><li>子查询的位置： select 中、from 后、where 中.group by 和order by 中无实用意义。</li></ul><h2 id="二、子查询分类"><a href="#二、子查询分类" class="headerlink" title="二、子查询分类"></a>二、子查询分类</h2><h3 id="子查询分为如下几类："><a href="#子查询分为如下几类：" class="headerlink" title="子查询分为如下几类："></a>子查询分为如下几类：</h3><ul><li>标量子查询：返回单一值的标量，最简单的形式。</li><li>列子查询：返回的结果集是 N 行一列。</li><li>行子查询：返回的结果集是一行 N 列。</li><li>表子查询：返回的结果集是 N 行 N 列。</li></ul><p>可以使用的操作符：= &gt; &lt; &gt;= &lt;= &lt;&gt; ANY IN SOME ALL EXISTS</p><p>一个子查询会返回一个标量（就一个值）、一个行、一个列或一个表，这些子查询称之为标量、行、列和表子查询。</p><p>如果子查询返回一个标量值（就一个值），那么外部查询就可以使用：=、&gt;、&lt;、&gt;=、&lt;=和&lt;&gt;符号进行比较判断；如果子查询返回的不是一个标量值，而外部查询使用了比较符和子查询的结果进行了比较，那么就会抛出异常。</p><h4 id="标量子查询："><a href="#标量子查询：" class="headerlink" title="标量子查询："></a>标量子查询：</h4><p>是指子查询返回的是单一值的标量，如一个数字或一个字符串，也是子查询中最简单的返回形式。 可以使用 = &gt; &lt; &gt;= &lt;= &lt;&gt; 这些操作符对子查询的标量结果进行比较，通常子查询的位置在比较式的右侧</p><p>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SELECT * FROM article WHERE uid = (SELECT uid FROM user WHERE status=1 ORDER BY uid DESC LIMIT 1)</span><br><span class="line"></span><br><span class="line">SELECT * FROM t1 WHERE column1 = (SELECT MAX(column2) FROM t2)</span><br><span class="line"></span><br><span class="line">SELECT * FROM article AS t WHERE 2 = (SELECT COUNT(*) FROM article WHERE article.uid = t.uid)</span><br></pre></td></tr></table></figure><h4 id="MySQL-列子查询："><a href="#MySQL-列子查询：" class="headerlink" title="MySQL 列子查询："></a>MySQL 列子查询：</h4><p>指子查询返回的结果集是 N 行一列，该结果通常来自对表的某个字段查询返回。</p><p>可以使用 = &gt; &lt; &gt;= &lt;= &lt;&gt; 这些操作符对子查询的标量结果进行比较，通常子查询的位置在比较式的右侧</p><p>可以使用 IN、ANY、SOME 和 ALL 操作符，不能直接使用 = &gt; &lt; &gt;= &lt;= &lt;&gt; 这些比较标量结果的操作符。</p><p>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM article WHERE uid IN(SELECT uid FROM user WHERE status=1)</span><br><span class="line"></span><br><span class="line">SELECT s1 FROM table1 WHERE s1 &gt; ANY (SELECT s2 FROM table2)</span><br><span class="line"></span><br><span class="line">SELECT s1 FROM table1 WHERE s1 &gt; ALL (SELECT s2 FROM table2)</span><br></pre></td></tr></table></figure><p>NOT IN 是 &lt;&gt; ALL 的别名，二者相同。<br>特殊情况:</p><ul><li>如果 table2 为空表，则 ALL 后的结果为 TRUE；</li><li>如果子查询返回如 (0,NULL,1) 这种尽管 s1 比返回结果都大，但有空行的结果，则 ALL 后的结果为 UNKNOWN 。</li></ul><p>注意：对于 table2 空表的情况，下面的语句均返回 NULL：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT s1 FROM table1 WHERE s1 &gt; (SELECT s2 FROM table2)</span><br><span class="line">SELECT s1 FROM table1 WHERE s1 &gt; ALL (SELECT MAX(s1) FROM table2)</span><br></pre></td></tr></table></figure><h4 id="MySQL-行子查询："><a href="#MySQL-行子查询：" class="headerlink" title="MySQL 行子查询："></a>MySQL 行子查询：</h4><p>指子查询返回的结果集是一行 N 列，该子查询的结果通常是对表的某行数据进行查询而返回的结果集。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">例子：</span><br><span class="line">SELECT * FROM table1 WHERE (1,2) = (SELECT column1, column2 FROM table2)</span><br><span class="line"></span><br><span class="line">注：(1,2) 等同于 row(1,2)</span><br><span class="line"></span><br><span class="line">SELECT * FROM article WHERE (title,content,uid) = (SELECT title,content,uid FROM blog WHERE bid=2)</span><br></pre></td></tr></table></figure><h4 id="MySQL-表子查询："><a href="#MySQL-表子查询：" class="headerlink" title="MySQL 表子查询："></a>MySQL 表子查询：</h4><p>指子查询返回的结果集是 N 行 N 列的一个表数据。<br>例子：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM article WHERE (title,content,uid) IN (SELECT title,content,uid FROM blog)</span><br></pre></td></tr></table></figure><p></p><h2 id="三、字查询例举"><a href="#三、字查询例举" class="headerlink" title="三、字查询例举"></a>三、字查询例举</h2><h4 id="ANY进行子查询"><a href="#ANY进行子查询" class="headerlink" title="ANY进行子查询"></a>ANY进行子查询</h4><p>any关键词的意思是“对于子查询返回的列中的任何一个数值，如果比较结果为TRUE，就返回TRUE”。</p><p>好比“10 &gt;any(11, 20, 2, 30)”，由于10&gt;2，所以，该该判断会返回TRUE；只要10与集合中的任意一个进行比较，得到TRUE时，就会返回TRUE。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select table1.customer_id,city,count(order_id)</span><br><span class="line">from table1 join table2</span><br><span class="line">on table1.customer_id=table2.customer_id</span><br><span class="line">where table1.customer_id&lt;&gt;&apos;tx&apos; and table1.customer_id&lt;&gt;&apos;9you&apos;</span><br><span class="line">group by customer_id</span><br><span class="line">having count(order_id) &gt;</span><br><span class="line">any (</span><br><span class="line">select count(order_id)</span><br><span class="line">from table2</span><br><span class="line">where customer_id=&apos;tx&apos; or customer_id=&apos;9you&apos;</span><br><span class="line">group by customer_id);</span><br></pre></td></tr></table></figure><p>any的意思比较好明白，直译就是任意一个，只要条件满足任意的一个，就返回TRUE。</p><h4 id="使用IN进行子查询"><a href="#使用IN进行子查询" class="headerlink" title="使用IN进行子查询"></a>使用IN进行子查询</h4><p>使用in进行子查询，这个我们在日常写sql的时候是经常遇到的。in的意思就是指定的一个值是否在这个集合中，如何在就返回TRUE；否则就返回FALSE了。</p><p>in是“=any”的别名，在使用“=any”的地方，我们都可以使用“in”来进行替换。</p><p>有了in，肯定就有了not in；not in并不是和&lt;&gt;any是同样的意思，not in和&lt;&gt;all是一个意思。</p><h4 id="使用SOME进行子查询"><a href="#使用SOME进行子查询" class="headerlink" title="使用SOME进行子查询"></a>使用SOME进行子查询</h4><p>some是any的别名，用的比较少。</p><h4 id="使用ALL进行子查询"><a href="#使用ALL进行子查询" class="headerlink" title="使用ALL进行子查询"></a>使用ALL进行子查询</h4><p>all必须与比较操作符一起使用。all的意思是“对于子查询返回的列中的所有值，如果比较结果为TRUE，则返回TRUE”。</p><p>好比“10 &gt;all(2, 4, 5, 1)”，由于10大于集合中的所有值，所以这条判断就返回TRUE；而如果为“10 &gt;all(20, 3, 2, 1, 4)”，这样的话，由于10小于20，所以该判断就会返回FALSE。</p><p>&lt;&gt;all的同义词是not in，表示不等于集合中的所有值，这个很容易和&lt;&gt;any搞混，平时多留点心就好了。</p><h4 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h4><p>根据子查询返回值的数量，将子查询可以分为标量子查询和多值子查询。在使用比较符进行子查询时，就要求必须是标量子查询；如果是多值子查询时，使用比较符，就会抛出异常。</p><h4 id="多值子查询"><a href="#多值子查询" class="headerlink" title="多值子查询"></a>多值子查询</h4><p>与标量子查询对应的就是多值子查询了，多值子查询会返回一列、一行或者一个表，它们组成一个集合。我们一般使用的any、in、all和some等词，将外部查询与子查询的结果进行判断。如果将any、in、all和some等词与标量子查询，就会得到空的结果。</p><h4 id="独立子查询"><a href="#独立子查询" class="headerlink" title="独立子查询"></a>独立子查询</h4><p>独立子查询是不依赖外部查询而运行的子查询。什么叫依赖外部查询？先看下面两个sql语句。</p><p>sql语句1：获得所有hangzhou顾客的订单号。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">select order_id</span><br><span class="line">from table2</span><br><span class="line">where customer_id in</span><br><span class="line">          (select customer_id</span><br><span class="line">          from table1</span><br><span class="line">          where city=&apos;hangzhou&apos;);</span><br><span class="line"></span><br><span class="line">sql语句2：获得城市为hangzhou，并且存在订单的用户。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select *</span><br><span class="line">from table1</span><br><span class="line">where city=&apos;hangzhou&apos; and exists</span><br><span class="line">                (select *</span><br><span class="line">                from table2</span><br><span class="line">                where table1.customer_id=table2.customer_id);</span><br></pre></td></tr></table></figure><p>上面的两条sql语句，虽然例子举的有点不是很恰当，但是足以说明这里的问题了。</p><p>对于sql语句1，我们将子查询单独复制出来，也是可以单独执行的，就是子查询与外部查询没有任何关系。</p><p>对于sql语句2，我们将子查询单独复制出来，就无法单独执行了，由于sql语句2的子查询依赖外部查询的某些字段，这就导致子查询就依赖外部查询，就产生了相关性。</p><p>对于子查询，很多时候都会考虑到效率的问题。当我们执行一个select语句时，可以加上explain关键字，用来查看查询类型，查询时使用的索引以及其它等等信息。比如这么用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">explain select order_id</span><br><span class="line">  from table2</span><br><span class="line">  where customer_id in</span><br><span class="line">            (select customer_id</span><br><span class="line">            from table1</span><br><span class="line">            where city=&apos;hangzhou&apos;);</span><br></pre></td></tr></table></figure><p>使用独立子查询，如果子查询部分对集合的最大遍历次数为n，外部查询的最大遍历次数为m时，我们可以记为：O(m+n)。而如果使用相关子查询，它的遍历 次数可能会达到O(m+m*n)。可以看到，效率就会成倍的下降；所以，大伙在使用子查询时，一定要考虑到子查询的相关性。</p><h4 id="相关子查询"><a href="#相关子查询" class="headerlink" title="相关子查询"></a>相关子查询</h4><p>相关子查询是指引用了外部查询列的子查询，即子查询会对外部查询的每行进行一次计算。但是在MySQL的内部，会进行动态优化，会随着情况的不同会 有所不同。使用相关子查询是最容易出现性能的地方。而关于sql语句的优化，这又是一个非常大的话题了，只能通过实际的经验积累，才能更好的去理解如何进 行优化。</p><h4 id="EXISTS谓词"><a href="#EXISTS谓词" class="headerlink" title="EXISTS谓词"></a>EXISTS谓词</h4><p>EXISTS是一个非常牛叉的谓词，它允许数据库高效地检查指定查询是否产生某些行。根据子查询是否返回行，该谓词返回TRUE或FALSE。与其 它谓词和逻辑表达式不同的是，无论输入子查询是否返回行，EXISTS都不会返回UNKNOWN，对于EXISTS来说，UNKNOWN就是FALSE。 还是上面的语句，获得城市为hangzhou，并且存在订单的用户。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from table1</span><br><span class="line">where city=&apos;hangzhou&apos; and exists</span><br><span class="line">                (select *</span><br><span class="line">                from table2</span><br><span class="line">                where table1.customer_id=table2.customer_id);</span><br></pre></td></tr></table></figure><p>关于IN和EXISTS的主要区别在于三值逻辑的判断上。EXISTS总是返回TRUE或FALSE，而对于IN，除了TRUE、FALSE值外， 还有可能对NULL值返回UNKNOWN。但是在过滤器中，UNKNOWN的处理方式与FALSE相同，因此使用IN与使用EXISTS一样，SQL优化 器会选择相同的执行计划。</p><p>说到了IN和EXISTS几乎是一样的，但是，就不得不说到NOT IN和NOT EXISTS，对于输入列表中包含NULL值时，NOT EXISTS和NOT IN之间的差异就表现的非常大了。输入列表包含NULL值时，IN总是返回TRUE和UNKNOWN，因此NOT IN就会得到NOT TRUE和NOT UNKNOWN，即FALSE和UNKNOWN。</p><h4 id="派生表"><a href="#派生表" class="headerlink" title="派生表"></a>派生表</h4><p>上面也说到了，在子查询返回的值中，也可能返回一个表，如果将子查询返回的虚拟表再次作为FROM子句的输入时，这就子查询的虚拟表就成为了一个派生表。语法结构如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM (subquery expression) AS derived_table_alias</span><br></pre></td></tr></table></figure><p>由于派生表是完全的虚拟表，并没有也不可能被物理地具体化。</p><h2 id="四、子查询优化"><a href="#四、子查询优化" class="headerlink" title="四、子查询优化"></a>四、子查询优化</h2><p><br>很多查询中需要使用子查询。使用子查询可以一次性的完成很多逻辑上需要多个步骤才能完成的SQL操作，同时也可以避免事务或者表锁死。子查询可以使查询语 句很灵活，但子查询的执行效率不高。</p><p>子查询时，MySQL需要为内层查询语句的查询结果建立一个临时表。然后外层查询语句再临时表中查询记录。查询完毕 后，MySQL需要撤销这些临时表。因此，子查询的速度会受到一定的影响。如果查询的数据量比较大，这种影响就会随之增大。</p><p>在MySQL中可以使用连接查 询来替代子查询。连接查询不需要建立临时表，其速度比子查询要快。</p><p>使用连接(JOIN)来代替子查询</p><p>如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">例子1：</span><br><span class="line"> </span><br><span class="line">SELECT * FROM t1</span><br><span class="line">WHERE t1.a1 NOT in (SELECT a2 FROM t2 )</span><br><span class="line">  </span><br><span class="line">优化后：</span><br><span class="line"> </span><br><span class="line">SELECT * FROM t1</span><br><span class="line">LEFT JOIN t2 ON t1.a1=t2.a2</span><br><span class="line">WHERE t2.a2 IS NULL  </span><br><span class="line">  </span><br><span class="line">例子2：</span><br><span class="line">SELECT * FROM article WHERE (title,content,uid) IN (SELECT title,content,uid FROM blog)</span><br><span class="line"> </span><br><span class="line">优化后：</span><br><span class="line"></span><br><span class="line">SELECT * FROM article</span><br><span class="line">inner join blog</span><br><span class="line">on (article.title=blog.title AND article.content=blog.content AND article.uid=blog.uid)</span><br></pre></td></tr></table></figure><p>不能优化的子查询：</p><ul><li>mysql不支持子查询合并和聚合函数子查询优化，mariadb对聚合函数子查询进行物化优化；</li><li>mysql不支持from子句子查询优化，mariadb对from子句子查询进行子查询上拉优化；</li><li>mysql和mariadb对子查询展开提供有限的支持，如对主键的操作才能进行上拉子查询优化；</li><li>mysql不支持exists子查询优化，mariadb对exists关联子查询进行半连接优化，对exists非关联子查询没有进一步进行优化；</li><li>mysql和mariadb不支持not exists子查询优化；</li><li>mysql和mariadb对in子查询，对满足半连接语义的查询进行半连接优化，再基于代价评估进行优化，两者对半连接的代价评估选择方式有差异；</li><li>mysql不支持not in子查询优化，mariadb对非关联not in子查询使用物化优化，对关联not in子查询不做优化；</li><li>mysql和mariadb对&gt;all非关联子查询使用max函数，&lt;all非关联子查询使用min函数，对=all和非关联子查询使用exists优化；</li><li>对&gt;some和&gt;any非关联子查询使用min函数，对&lt;some和&lt;any非关联子查询使用max函数，=any 和=some子查询使用半连接进行优化，对&gt;some和&gt;any关联子查询以及&lt;some和&lt;any关联子查询只有exists 优化。</li></ul></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://www.elonchung.cn/2017/07/zichaxun/" title="MySQL的子查询" target="_blank" rel="external">https://www.elonchung.cn/2017/07/zichaxun/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/zhongweixiang?tab=repositories" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.png" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/zhongweixiang?tab=repositories" target="_blank"><span class="text-dark">Elon Chung</span><small class="ml-1x">JAVA PHP Web Developer</small></a></h3><div>乐观自信爱生活；沉着冷静撸代码。</div></div></figure></div></div></div></article><section id="comments"></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2017/07/framework/" title="当前Web高效开发必备的PHP框架"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2017/07/jenkis/" title="hexo使用jenkins自动部署到阿里云"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/zhongweixiang?tab=repositories" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/331845158" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li></ul><div class="copyright">&copy; 2020 Elon Chung<div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div>粤ICP备18050169号-1</div></footer><script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var N={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=N}(window)</script><script src="/js/insight.js"></script><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment=new Gitment({id:"MySQL的子查询",owner:"zhongweixiang",repo:"zhongweixiang.github.io",oauth:{client_id:"0e7d3cfb086ee391e950",client_secret:"b4bb522dc433143cbc124889d04d684a2ca9e742"}});gitment.render("comments")</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?bdd558368004a3dff28c0ad7c2b08e48";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html><!-- rebuild by neat -->