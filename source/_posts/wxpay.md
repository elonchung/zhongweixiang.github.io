---
title: 微信支付
date: 2019-08-15 16:54:28
categories:
- WeChat
tags:
- WeChat
toc: true # 是否启用内容索引
keywords: 微信支付
description: 微信支付
---

### 微信支付

1. 接口方式： JSAPI 、付款码、NATIVE、APP支付、H5支付、小程序支付、刷脸支付

#### JSAPI支付：

应用场景：商户已有H5商城网站，用户通过消息或扫描二维码在微信内打开网页时，可以调用微信支付完成下单购买的流程。

##### **公众号上设置**

1. **支付目录设置：**

   - 商户最后请求拉起微信支付收银台的页面地址我们称之为“支付目录”，商户实际的支付目录必须和在微信支付商户平台设置的一致，否则会报错“当前页面的URL未注册“

2. **支付授权目录设置**

   - 登录微信支付商户平台（pay.weixin.qq.com）-->产品中心-->开发配置，设置后一般5分钟内生效。

3. **支付授权目录校验规则说明：**

   1、如果支付授权目录设置为顶级域名（例如：https://www.weixin.com/ ），那么只校验顶级域名，不校验后缀；

   2、如果支付授权目录设置为多级目录，就会进行全匹配，例如设置支付授权目录为https://www.weixin.com/abc/123/，则实际请求页面目录不能为https://www.weixin.com/abc/，也不能为https://www.weixin.com/abc/123/pay/，必须为https://www.weixin.com/abc/123/

4. 设置授权域名、

   1. 主要获取openid的域名

5. 

##### **商户号上设置**

1. 设置支付秘钥（自己生成md5串）
2. 设置证书（退款需要）

##### **业务流程图**

![微信内网页支付时序图](https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_4_1.png)









appid 服务商 APPID

mch_id 微信支付分配的商户号

sub_appid

分账 -- 双向证书







作者：梁川
链接：https://www.zhihu.com/question/48909315/answer/136528033
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



我理解题主指的APP平台不只是APP，还包括B2B的商城管理系统，以实现商家入驻对管理上架商品。
如果是这样，那么两种模式都可以支持。
最核心的问题是：B2B的商城管理系统是否支持商家配置自己的微信支付/支付宝的商户号、支付密钥等信息，商家是否愿意把支付密钥等私密信息配置到一个第三方平台（类似很多微信商城管理系统的做法）。

1、模式1
如果APP支持商家通过商城管理系统配置自己的商户号、支付密钥等信息，用户购买商品时候商城平台使用对应商户的商户号、支付密钥发起支付请求，微信支付/支付宝直接将资金结算给商家对公户，资金不过平台。
由于平台本身有订单信息，因此可以根据对应的订单信息计算出对应的佣金，与商户对账后，由商家把佣金通过企业网银、第三方支付代付等方式转账给平台。

2、模式2
此种模式比较典型，也是美团、饿了么之类的互联网电商平台的通用做法。
此种模式下，用户购买商品时，发起支付请求使用的商户号、支付密钥是平台的，微信支付/支付宝将资金结算给平台对公户，然后由平台按照结算周期将资金结算给商户。

题主后面的问题是结算款项代付问题。
代付的方式有很多，依赖于诸多因素，例如：
1、代付渠道：例如个人网银、超级网银、结算中心、央行大小额、银企直连等
2、本行/跨行
3、对公/对私
4、代付金额：大于5万，小于五万等等
5、时效性：实时、2小时、次日到账
6、单笔/批量
以上各种因素都会影响代付的成本，可以根据自己需要对比选择合适的方案。

